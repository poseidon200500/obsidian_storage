---
tags:
  - Программирование
  - Теория_по_языку_Golang
  - Ассемблер
Связанные темы:
---
## **Ассемблерные компоненты Go**  
*Низкоуровневые реализации, ассемблерные вставки, runtime примитивы*

---

## **1. [[Atomic операции на ассемблере]]**  
*Реализация атомарных примитивов для разных архитектур*  
- **CAS для AMD64**: `LOCK CMPXCHGQ`, memory ordering гарантии
- **ARM64 атомики**: `LDXR/STXR` пары, exclusive monitors
- **Load/Store барьеры**: `MFENCE`, `DMB` инструкции
- **Runtime атомики**: `runtime/internal/atomic` реализации
- **JIT-компиляция**: адаптация под конкретный CPU
- **False sharing**: выравнивание кэш-линий на ассемблере

---

## **2. [[Ассемблерные прологи горутин]]**  
*Инициализация и переключение контекста*  
- **gostartcall**: подготовка аргументов для новой горутины
- **morestack**: проверка и рост стека, stack barrier вставки
- **gosave/gogo**: сохранение/восстановление регистров
- **mcall**: переход из горутины в планировщик
- **systemstack**: выполнение в системном стеке
- **asyncPreempt**: асинхронные прерывания горутин

---

## **3. [[Планировщик на ассемблере]]**  
*Низкоуровневые механизмы work stealing*  
- **schedule**: дизассемблированный цикл планировщика
- **findrunnable**: поиск работы с ассемблерными оптимизациями
- **wakep**: пробуждение потоков, атомарные операции с mcount
- **retake**: принудительное переключение горутин
- **sysmon**: системный монитор, netpoll интеграция
- **preemption**: точки прерывания в ассемблерном коде

---

## **4. [[Системные вызовы и ABI]]**  
*Трансляция вызовов между Go и ядром ОС*  
- **syscall.Entry**: переход в kernel mode на разных платформах
- **cgo callbacks**: преобразование calling conventions
- **args setup**: подготовка аргументов в регистрах/стеке
- **ABIInternal**: новая ABI Go 1.17+, регистровые передача
- **nosplit функции**: ограничения стека на ассемблере
- **wrap для syscalls**: обработка ошибок, errno преобразование

---

## **5. [[Write barriers и GC]]**  
*Ассемблерные маркеры сборщика мусора*  
- **writebarrierptr**: барьеры для указателей
- **bulkBarrierPreWrite**: массовые барьеры для копирования
- **gcWriteBarrier**: дизассемблированные обработчики
- **heap bitmap**: доступ к битовым картам на ассемблере
- **stack scanning**: сканирование стека с точностью до регистров
- **conservative scanning**: обработка ambiguous pointers

---

## **6. [[Векторные инструкции в stdlib]]**  
*SIMD оптимизации в стандартной библиотеке*  
- **bytes.Equal**: SSE2/AVX2 сравнения больших блоков
- **crypto/cipher**: AES-NI инструкции для шифрования
- **hash/crc32**: аппаратное вычисление CRC
- **strings поиск**: векторные алгоритмы поиска подстрок
- **memclr/memmove**: оптимизированное зануление/копирование
- **runtime.memhash**: SIMD хэш-функции для map

---

## **7. [[Ассемблерные деферы и паника]]**  
*Обработка исключений и отложенных вызовов*  
- **deferproc**: создание дефера с ассемблерным прологом
- **deferreturn**: выполнение деферов при возврате
- **gopanic**: раскрутка стека, поиск recover
- **gorecover**: манипуляции с panic структурой
- **defer args**: передача аргументов через стек/регистры
- **open-coded деферы**: оптимизация в Go 1.14+

---

## **8. [[JIT и динамический код]]**  
*Генерация кода в runtime*  
- **reflect.MakeFunc**: создание функций на лету
- **go:linkname**: связывание с runtime функциями
- **функции-заглушки**: stub для cgo, платформозависимый код
- **trampolines**: переходники между разными ABI
- **method values**: ассемблерные обёртки для методов
- **closure реализация**: захват переменных на ассемблере

---
