---
tags:
  - Программирование
  - ВебОсновы
  - TCP
---
# TCP (Transmission Control Protocol)

## Основные принципы работы

TCP — это надежный протокол транспортного уровня, обеспечивающий гарантированную доставку данных между приложениями. Его работа основана на нескольких ключевых механизмах:

### Установка соединения (Three-way handshake)

```plaintext
Клиент                          Сервер
  |                               |
  | ----------- SYN ------------> |
  | <--------- SYN-ACK ---------- |
  | ----------- ACK ------------> |
  |                               |
```


Перед началом передачи данных клиент и сервер выполняют "рукопожатие":
1. Клиент отправляет SYN-пакет с начальным номером последовательности
2. Сервер отвечает SYN-ACK пакетом (подтверждение + свой номер последовательности)
3. Клиент отправляет ACK, подтверждая получение

Этот процесс гарантирует, что обе стороны готовы к обмену данными.

### Завершение соединения (4-way handshake)

```plaintext
Клиент                          Сервер
  |                               |
  | ----------- FIN ------------> |
  | <--------- ACK -------------- |
  | <--------- FIN -------------- |
  | ----------- ACK ------------> |
  |                               |
```


### Надежная доставка данных
TCP использует несколько механизмов для обеспечения надежности:
- **Нумерация сегментов**: Каждый байт данных имеет порядковый номер
- **Подтверждения (ACK)**: Получатель подтверждает получение данных
- **Повторная передача**: При отсутствии подтверждения данные отправляются снова
- **Контроль потока**: Механизм скользящего окна регулирует скорость передачи

### Управление перегрузкой
Для предотвращения перегрузки сети TCP использует:
- Динамическое изменение размера окна передачи
- Алгоритмы обнаружения перегрузки (Reno, Cubic, BBR)
- Медленный старт (постепенное увеличение скорости)

## Архитектура протокола

### Заголовок TCP
Каждый TCP-сегмент содержит заголовок с важной информацией:
- Порт источника и назначения
- Номера последовательности и подтверждения
- Флаги управления (SYN, ACK, FIN и др.)
- Размер окна (для контроля потока)
- Контрольная сумма (для проверки целостности)

### Состояния соединения
TCP соединение проходит через несколько состояний:
1. LISTEN (сервер ожидает подключения)
2. SYN-SENT (клиент отправил SYN)
3. SYN-RECEIVED (сервер получил SYN)
4. ESTABLISHED (соединение установлено)
5. FIN-WAIT (начало закрытия)
6. CLOSED (соединение закрыто)

## Особенности и оптимизации

### Механизмы ускорения
- **TCP Fast Open**: Позволяет отправлять данные во время handshake
- **Selective ACK**: Точечное подтверждение полученных блоков
- **Window Scaling**: Увеличение максимального размера окна

### Проблемы и решения
1. **Высокая задержка**: 
   - Использование алгоритмов типа BBR
   - Уменьшение размера начального окна

2. **Потеря пакетов**:
   - Быстрая повторная передача
   - Настройка таймаутов

3. **Перегрузка сети**:
   - Динамическое регулирование скорости
   - Explicit Congestion Notification (ECN)

## Применение в современных системах

TCP остается фундаментальным протоколом для:
- Веб-трафика (HTTP/HTTPS)
- Передачи файлов (FTP, SFTP)
- Удаленного доступа (SSH, RDP)
- Электронной почты (SMTP)
- Систем баз данных

Несмотря на появление альтернатив (как QUIC в HTTP/3), TCP продолжает развиваться, сохраняя свою актуальность в современных сетях.

