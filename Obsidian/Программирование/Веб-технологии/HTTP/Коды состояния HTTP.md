---
tags:
  - Программирование
  - ВебОсновы
  - HTTP
---
# Коды состояния HTTP

## Классификация статусов

HTTP использует 3-значные коды состояния, где первая цифра определяет класс ответа:

| Класс | Описание                  | Примеры               |
|-------|---------------------------|-----------------------|
| 1xx   | Информационные            | 100 Continue          |
| 2xx   | Успешные                  | 200 OK, 201 Created   |
| 3xx   | Перенаправления           | 301 Moved Permanently |
| 4xx   | Ошибки клиента            | 404 Not Found         |
| 5xx   | Ошибки сервера            | 500 Internal Error    |

## Основные коды состояния

### 2xx - Успешные запросы

**200 OK**  
Стандартный ответ для успешных HTTP-запросов  
*Пример:*  
```http
HTTP/1.1 200 OK
Content-Type: application/json

{"status": "success"}
```

**201 Created**  
Успешное создание ресурса  
*Особенности:*  
- Должен включать заголовок Location с URI нового ресурса  
- Тело ответа может содержать представление созданного ресурса  

**204 No Content**  
Успешный запрос без возвращаемого содержимого  
*Использование:*  
- Удачные операции DELETE  
- Обновления без возврата данных  

### 3xx - Перенаправления

**301 Moved Permanently**  
Постоянное перенаправление  
*Особенности:*  
- Поисковики обновляют ссылки  
- Клиенты кэшируют перенаправление  

**302 Found**  
Временное перенаправление  
*Отличие от 301:*  
- Не кэшируется по умолчанию  
- Поисковики не обновляют URL  

**304 Not Modified**  
Ресурс не изменился (для условных GET)  
*Условия:*  
- Заголовки If-Modified-Since/If-None-Match  
- Пустое тело ответа  

### 4xx - Ошибки клиента

**400 Bad Request**  
Некорректный синтаксис запроса  
*Типичные причины:*  
- Невалидный JSON  
- Отсутствующие обязательные параметры  

**401 Unauthorized**  
Требуется аутентификация  
*Важно:*  
- Должен включать WWW-Authenticate заголовок  
- Отличается от 403 (нет прав vs нет аутентификации)  

**403 Forbidden**  
Доступ запрещен  
*Примеры:*  
- Попытка доступа к чужим данным  
- Доступ с IP из черного списка  

**404 Not Found**  
Ресурс не существует  
*Особенности:*  
- Для скрытия существования ресурса - использовать 403  
- Может применяться вместо 401 для защиты от перебора  

### 5xx - Ошибки сервера

**500 Internal Server Error**  
Общая ошибка сервера  
*Когда использовать:*  
- Необработанное исключение  
- Неизвестная внутренняя ошибка  

**502 Bad Gateway**  
Проблема с upstream-сервером  
*Типичные сценарии:*  
- Прокси не может получить ответ от бэкенда  
- Сервер приложений не отвечает  

**503 Service Unavailable**  
Сервис временно недоступен  
*Причины:*  
- Техническое обслуживание  
- Перегрузка сервера  

## Специальные коды состояния

**418 I'm a teapot** (RFC 2324)  
Шуточный код, не используемый на практике  

**429 Too Many Requests**  
Превышен лимит запросов  
*Использование:*  
- Rate limiting API  
- Защита от DDoS  

**451 Unavailable For Legal Reasons**  
Доступ ограничен по юридическим причинам  

## Лучшие практики

1. **Точность выбора кода**:
   - 400 вместо 500 при ошибках валидации  
   - 404 для отсутствующих ресурсов, 410 для удаленных  

2. **Согласованность API**:
   - Единые коды для одинаковых ситуаций  
   - Документация используемых статусов  

3. **Безопасность**:
   - 401 вместо 404 для защищенных ресурсов  
   - 403 для скрытия существования данных  

4. **Обработка ошибок**:
   - Человекочитаемые описания в теле ответа  
   - Ссылки на документацию при 4xx ошибках  

## Примеры обработки в Go

```go
// Успешный ответ
func successHandler(w http.ResponseWriter, r *http.Request) {
    w.WriteHeader(http.StatusOK)
    json.NewEncoder(w).Encode(responseData)
}

// Ошибка клиента
func clientErrorHandler(w http.ResponseWriter, r *http.Request) {
    w.WriteHeader(http.StatusBadRequest)
    json.NewEncoder(w).Encode(struct{
        Error string `json:"error"`
    }{
        Error: "Invalid request parameters",
    })
}

// Ошибка сервера
func serverErrorHandler(w http.ResponseWriter, r *http.Request) {
    w.WriteHeader(http.StatusInternalServerError)
    // Логирование ошибки
}
```